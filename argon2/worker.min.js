/**
 * @license
 * @very-amused/argon2-wasm v0.4.0
 * MIT License
 * Copyright (c) 2025 Keith Scroggs
 */
class e{constructor(e){this.worker=e,this.worker.addEventListener("message",(e=>{this.onMessage(e)}),!0)}onMessage(e){this.resolve&&this.resolve(e.data)}postMessage(e,r=[]){const _=new Promise((e=>{this.resolve=e}));return this.worker.postMessage(e,r),_}terminate(){this.worker.removeEventListener("message",(e=>{this.onMessage(e)}),!0),this.worker.terminate()}}const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function _(e,_){_[0]=r.charCodeAt(e[0]>>2),1!==e.byteLength?(_[1]=r.charCodeAt(e[0]<<4&48|e[1]>>4),2!==e.byteLength?(_[2]=r.charCodeAt(e[1]<<2&60|e[2]>>6),_[3]=r.charCodeAt(63&e[2])):_[2]=r.charCodeAt(e[1]<<2&60)):_[1]=r.charCodeAt(e[0]<<4&48)}function t(e,r){r[0]=e[0]<<2|e[1]>>4,1!==r.byteLength&&(r[1]=e[1]<<4|e[2]>>2,2!==r.byteLength&&(r[2]=e[2]<<6|e[3]))}var o,O;let n;function A(e){return e instanceof Error?e.message:"string"==typeof e?e:"An unknown error has occured, and a message was unable to be parsed from this error"}!function(e){e.encode=function(e){const r=4*Math.floor(e.byteLength/3)+(e.byteLength%3!=0?4:0),t=new Uint8Array(r);let o=0,O=0;for(;o<e.byteLength-2;o+=3,O+=4)_(new Uint8Array(e.buffer,o,3),new Uint8Array(t.buffer,O,4));switch(e.byteLength%3){case 1:_(new Uint8Array(e.buffer,e.byteLength-1,1),new Uint8Array(t.buffer,r-4,2)),t[t.byteLength-2]="=".charCodeAt(0),t[t.byteLength-1]="=".charCodeAt(0);break;case 2:_(new Uint8Array(e.buffer,e.byteLength-2,2),new Uint8Array(t.buffer,r-4,3)),t[t.byteLength-1]="=".charCodeAt(0)}return(new TextDecoder).decode(t)},e.decode=function(e){const r=function(e){let r=e.byteLength;for(let _=e.byteLength-2;_<e.byteLength;_++)e[_]==="=".charCodeAt(0)&&r--;const _=new Uint8Array(r);for(let t=0;t<r;t++)if(e[t]>=48&&e[t]<=57)_[t]=e[t]+4;else if(e[t]>=65&&e[t]<=90)_[t]=e[t]-65;else if(e[t]>=97&&e[t]<=122)_[t]=e[t]-71;else if(43===e[t])_[t]=62;else{if(47!==e[t])throw new Error("invalid base64 input (StdEncoding)");_[t]=63}return _}((new TextEncoder).encode(e.replaceAll(/[\r\n]/g,""))),_=3*Math.floor(r.byteLength/4)+r.byteLength%4-(r.byteLength%4>0?1:0),o=new Uint8Array(_);let O=0,n=0;for(;O<r.byteLength-3;O+=4,n+=3)t(new Uint8Array(r.buffer,O,4),new Uint8Array(o.buffer,n,3));switch(r.byteLength%4){case 2:t(new Uint8Array(r.buffer,r.byteLength-2,2),new Uint8Array(o.buffer,o.byteLength-1,1));break;case 3:t(new Uint8Array(r.buffer,r.byteLength-3,3),new Uint8Array(o.buffer,o.byteLength-2,2))}return o}}(o||(o={})),function(r){var _,t,O,n;r.WorkerConnection=e,(_=r.Modes||(r.Modes={})).Argon2i="2i",_.Argon2d="2d",_.Argon2id="2id",(t=r.Versions||(r.Versions={}))[t.ARGON2_VERSION_10=16]="ARGON2_VERSION_10",t[t.ARGON2_VERSION_13=19]="ARGON2_VERSION_13",t[t.ARGON2_VERSION_NUMBER=19]="ARGON2_VERSION_NUMBER",(O=r.Methods||(r.Methods={}))[O.LoadArgon2=0]="LoadArgon2",O[O.Hash2i=1]="Hash2i",O[O.Hash2d=2]="Hash2d",O[O.Hash2id=3]="Hash2id",O[O.UnloadArgon2=4]="UnloadArgon2",O[O.Hash=5]="Hash",(n=r.ErrorCodes||(r.ErrorCodes={}))[n.ARGON2_OK=0]="ARGON2_OK",n[n.ARGON2_OUTPUT_PTR_NULL=-1]="ARGON2_OUTPUT_PTR_NULL",n[n.ARGON2_OUTPUT_TOO_SHORT=-2]="ARGON2_OUTPUT_TOO_SHORT",n[n.ARGON2_OUTPUT_TOO_LONG=-3]="ARGON2_OUTPUT_TOO_LONG",n[n.ARGON2_PWD_TOO_SHORT=-4]="ARGON2_PWD_TOO_SHORT",n[n.ARGON2_PWD_TOO_LONG=-5]="ARGON2_PWD_TOO_LONG",n[n.ARGON2_SALT_TOO_SHORT=-6]="ARGON2_SALT_TOO_SHORT",n[n.ARGON2_SALT_TOO_LONG=-7]="ARGON2_SALT_TOO_LONG",n[n.ARGON2_AD_TOO_SHORT=-8]="ARGON2_AD_TOO_SHORT",n[n.ARGON2_AD_TOO_LONG=-9]="ARGON2_AD_TOO_LONG",n[n.ARGON2_SECRET_TOO_SHORT=-10]="ARGON2_SECRET_TOO_SHORT",n[n.ARGON2_SECRET_TOO_LONG=-11]="ARGON2_SECRET_TOO_LONG",n[n.ARGON2_TIME_TOO_SMALL=-12]="ARGON2_TIME_TOO_SMALL",n[n.ARGON2_TIME_TOO_LARGE=-13]="ARGON2_TIME_TOO_LARGE",n[n.ARGON2_MEMORY_TOO_LITTLE=-14]="ARGON2_MEMORY_TOO_LITTLE",n[n.ARGON2_MEMORY_TOO_MUCH=-15]="ARGON2_MEMORY_TOO_MUCH",n[n.ARGON2_LANES_TOO_FEW=-16]="ARGON2_LANES_TOO_FEW",n[n.ARGON2_LANES_TOO_MANY=-17]="ARGON2_LANES_TOO_MANY",n[n.ARGON2_PWD_PTR_MISMATCH=-18]="ARGON2_PWD_PTR_MISMATCH",n[n.ARGON2_SALT_PTR_MISMATCH=-19]="ARGON2_SALT_PTR_MISMATCH",n[n.ARGON2_SECRET_PTR_MISMATCH=-20]="ARGON2_SECRET_PTR_MISMATCH",n[n.ARGON2_AD_PTR_MISMATCH=-21]="ARGON2_AD_PTR_MISMATCH",n[n.ARGON2_MEMORY_ALLOCATION_ERROR=-22]="ARGON2_MEMORY_ALLOCATION_ERROR",n[n.ARGON2_FREE_MEMORY_CBK_NULL=-23]="ARGON2_FREE_MEMORY_CBK_NULL",n[n.ARGON2_ALLOCATE_MEMORY_CBK_NULL=-24]="ARGON2_ALLOCATE_MEMORY_CBK_NULL",n[n.ARGON2_INCORRECT_PARAMETER=-25]="ARGON2_INCORRECT_PARAMETER",n[n.ARGON2_INCORRECT_TYPE=-26]="ARGON2_INCORRECT_TYPE",n[n.ARGON2_OUT_PTR_MISMATCH=-27]="ARGON2_OUT_PTR_MISMATCH",n[n.ARGON2_THREADS_TOO_FEW=-28]="ARGON2_THREADS_TOO_FEW",n[n.ARGON2_THREADS_TOO_MANY=-29]="ARGON2_THREADS_TOO_MANY",n[n.ARGON2_MISSING_ARGS=-30]="ARGON2_MISSING_ARGS",n[n.ARGON2_ENCODING_FAIL=-31]="ARGON2_ENCODING_FAIL",n[n.ARGON2_DECODING_FAIL=-32]="ARGON2_DECODING_FAIL",n[n.ARGON2_THREAD_FAIL=-33]="ARGON2_THREAD_FAIL",n[n.ARGON2_DECODING_LENGTH_FAIL=-34]="ARGON2_DECODING_LENGTH_FAIL",n[n.ARGON2_VERIFY_MISMATCH=-35]="ARGON2_VERIFY_MISMATCH",n[n.ARGON2WASM_UNKNOWN=1]="ARGON2WASM_UNKNOWN",n[n.ARGON2WASM_BAD_REQUEST=2]="ARGON2WASM_BAD_REQUEST",n[n.ARGON2WASM_UNSUPPORTED_BROWSER=3]="ARGON2WASM_UNSUPPORTED_BROWSER",r.encode=function(e,_){return`$argon${e.mode}$v=${r.Versions.ARGON2_VERSION_NUMBER}$m=${e.memoryCost},t=${e.timeCost},p=${e.threads}$${o.encode(e.salt)}$${o.encode(_)}`}}(O||(O={}));const a=(e,r=[])=>{self.postMessage(e,r)};function s(e,r){for(let _=0;_<r.length;_++)e[_]=r[_]}function R(e,r=3){for(let _=0;_<r;_++)for(let r=0;r<e.length;r++)e[r]=0}async function N(e=".",r=!1,_=!1){if("object"!=typeof WebAssembly)throw O.ErrorCodes.ARGON2WASM_UNSUPPORTED_BROWSER;if(r&&(r=await async function(e="."){const r=await fetch(`${e}/simd-test.wasm`),_=await r.arrayBuffer();return WebAssembly.validate(_)}(e)),_&&(_="undefined"!=typeof SharedArrayBuffer),_){const t=`${e}/${`argon2${r?"-simd":""}-pthread.js`}`;importScripts(t);const o=new WebAssembly.Memory({initial:1024,maximum:65536,shared:!0}),O=await LoadArgon2Wasm({mainScriptUrlOrBlob:t,wasmMemory:o});return{malloc:O._malloc,free:O._free,argon2i_hash_raw:O._argon2i_hash_raw,argon2d_hash_raw:O._argon2d_hash_raw,argon2id_hash_raw:O._argon2id_hash_raw,memory:o,pthread:_}}{const t=`argon2${r?"-simd":""}.wasm`,o={env:{emscripten_notify_memory_growth(){}}};return{...(await WebAssembly.instantiateStreaming(fetch(`${e}/${t}`),o)).instance.exports,pthread:_}}}function d(e){let r;switch(e.mode){case O.Modes.Argon2i:r=n.argon2i_hash_raw;break;case O.Modes.Argon2d:r=n.argon2d_hash_raw;break;case O.Modes.Argon2id:r=n.argon2id_hash_raw;default:return{code:O.ErrorCodes.ARGON2_INCORRECT_PARAMETER,body:void 0}}const _=e.salt.byteLength,t=n.malloc(_);let o=new Uint8Array(n.memory.buffer,t,_);s(o,e.salt);const A=(new TextEncoder).encode(e.password),a=A.byteLength,N=n.malloc(a);let d=new Uint8Array(n.memory.buffer,N,a);s(d,A),R(A);const T=e.hashLen,i=n.malloc(T),c=r(e.timeCost,e.memoryCost,e.threads,N,a,t,_,i,T);d=new Uint8Array(n.memory.buffer,N,a),R(d),n.free(N),o=new Uint8Array(n.memory.buffer,t,_),R(o),n.free(t),R(e.salt);const E=new Uint8Array(T),G=new Uint8Array(n.memory.buffer,i,T);return s(E,G),R(G),n.free(i),{code:c,body:E}}onmessage=async function(e){(Array.isArray(e.data)||"object"!=typeof e.data)&&a({code:O.ErrorCodes.ARGON2WASM_BAD_REQUEST});const r=e.data;switch(r.method){case O.Methods.LoadArgon2:try{const e=r.params;n=await N(e.wasmRoot,e.simd,e.pthread)}catch(e){return void function(e){"number"==typeof e&&e in O.ErrorCodes?a({code:e}):a({code:O.ErrorCodes.ARGON2WASM_UNKNOWN,message:A(e)})}(e)}a({code:O.ErrorCodes.ARGON2_OK});break;case O.Methods.Hash:{const e=d(r.params);a({code:e.code,body:e.body},[e.body.buffer])}case O.Methods.Hash2i:{const e=r.params;e.mode=O.Modes.Argon2i;const _=d(e);a({code:_.code,body:_.body},[_.body.buffer])}break;case O.Methods.Hash2d:{const e=r.params;e.mode=O.Modes.Argon2d;const _=d(e);a({code:_.code,body:_.body},[_.body.buffer])}break;case O.Methods.Hash2id:{const e=r.params;e.mode=O.Modes.Argon2id;const _=d(e);a({code:_.code,body:_.body},[_.body.buffer])}break;default:a({code:O.ErrorCodes.ARGON2WASM_BAD_REQUEST})}};
