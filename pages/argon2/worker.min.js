class _{constructor(_){this.worker=_,this.worker.addEventListener("message",(_=>{this.onMessage(_)}),!0)}onMessage(_){this.resolve&&this.resolve(_.data)}postMessage(_,O=[]){const A=new Promise((_=>{this.resolve=_}));return this.worker.postMessage(_,O),A}deinit(){this.worker.removeEventListener("message",(_=>{this.onMessage(_)}),!0),this.worker.terminate()}}var O;let A;function e(_){return _ instanceof Error?_.message:"string"==typeof _?_:"An unknown error has occured, and a message was unable to be parsed from this error"}!function(O){var A,e;O.WorkerConnection=_,(A=O.Methods||(O.Methods={}))[A.LoadArgon2=0]="LoadArgon2",A[A.Hash2i=1]="Hash2i",(e=O.ErrorCodes||(O.ErrorCodes={}))[e.ARGON2_OK=0]="ARGON2_OK",e[e.ARGON2_OUTPUT_PTR_NULL=-1]="ARGON2_OUTPUT_PTR_NULL",e[e.ARGON2_OUTPUT_TOO_SHORT=-2]="ARGON2_OUTPUT_TOO_SHORT",e[e.ARGON2_OUTPUT_TOO_LONG=-3]="ARGON2_OUTPUT_TOO_LONG",e[e.ARGON2_PWD_TOO_SHORT=-4]="ARGON2_PWD_TOO_SHORT",e[e.ARGON2_PWD_TOO_LONG=-5]="ARGON2_PWD_TOO_LONG",e[e.ARGON2_SALT_TOO_SHORT=-6]="ARGON2_SALT_TOO_SHORT",e[e.ARGON2_SALT_TOO_LONG=-7]="ARGON2_SALT_TOO_LONG",e[e.ARGON2_AD_TOO_SHORT=-8]="ARGON2_AD_TOO_SHORT",e[e.ARGON2_AD_TOO_LONG=-9]="ARGON2_AD_TOO_LONG",e[e.ARGON2_SECRET_TOO_SHORT=-10]="ARGON2_SECRET_TOO_SHORT",e[e.ARGON2_SECRET_TOO_LONG=-11]="ARGON2_SECRET_TOO_LONG",e[e.ARGON2_TIME_TOO_SMALL=-12]="ARGON2_TIME_TOO_SMALL",e[e.ARGON2_TIME_TOO_LARGE=-13]="ARGON2_TIME_TOO_LARGE",e[e.ARGON2_MEMORY_TOO_LITTLE=-14]="ARGON2_MEMORY_TOO_LITTLE",e[e.ARGON2_MEMORY_TOO_MUCH=-15]="ARGON2_MEMORY_TOO_MUCH",e[e.ARGON2_LANES_TOO_FEW=-16]="ARGON2_LANES_TOO_FEW",e[e.ARGON2_LANES_TOO_MANY=-17]="ARGON2_LANES_TOO_MANY",e[e.ARGON2_PWD_PTR_MISMATCH=-18]="ARGON2_PWD_PTR_MISMATCH",e[e.ARGON2_SALT_PTR_MISMATCH=-19]="ARGON2_SALT_PTR_MISMATCH",e[e.ARGON2_SECRET_PTR_MISMATCH=-20]="ARGON2_SECRET_PTR_MISMATCH",e[e.ARGON2_AD_PTR_MISMATCH=-21]="ARGON2_AD_PTR_MISMATCH",e[e.ARGON2_MEMORY_ALLOCATION_ERROR=-22]="ARGON2_MEMORY_ALLOCATION_ERROR",e[e.ARGON2_FREE_MEMORY_CBK_NULL=-23]="ARGON2_FREE_MEMORY_CBK_NULL",e[e.ARGON2_ALLOCATE_MEMORY_CBK_NULL=-24]="ARGON2_ALLOCATE_MEMORY_CBK_NULL",e[e.ARGON2_INCORRECT_PARAMETER=-25]="ARGON2_INCORRECT_PARAMETER",e[e.ARGON2_INCORRECT_TYPE=-26]="ARGON2_INCORRECT_TYPE",e[e.ARGON2_OUT_PTR_MISMATCH=-27]="ARGON2_OUT_PTR_MISMATCH",e[e.ARGON2_THREADS_TOO_FEW=-28]="ARGON2_THREADS_TOO_FEW",e[e.ARGON2_THREADS_TOO_MANY=-29]="ARGON2_THREADS_TOO_MANY",e[e.ARGON2_MISSING_ARGS=-30]="ARGON2_MISSING_ARGS",e[e.ARGON2_ENCODING_FAIL=-31]="ARGON2_ENCODING_FAIL",e[e.ARGON2_DECODING_FAIL=-32]="ARGON2_DECODING_FAIL",e[e.ARGON2_THREAD_FAIL=-33]="ARGON2_THREAD_FAIL",e[e.ARGON2_DECODING_LENGTH_FAIL=-34]="ARGON2_DECODING_LENGTH_FAIL",e[e.ARGON2_VERIFY_MISMATCH=-35]="ARGON2_VERIFY_MISMATCH",e[e.ARGON2WASM_UNKNOWN=1]="ARGON2WASM_UNKNOWN",e[e.ARGON2WASM_BAD_REQUEST=2]="ARGON2WASM_BAD_REQUEST",e[e.ARGON2WASM_UNSUPPORTED_BROWSER=3]="ARGON2WASM_UNSUPPORTED_BROWSER"}(O||(O={}));const R=(_,O=[])=>{self.postMessage(_,O)};function N(_,O=1){for(let A=0;A<O;A++)for(let O=0;O<_.length;O++)_[O]=0}async function r(_=".",A=!1){if("object"!=typeof WebAssembly)throw O.ErrorCodes.ARGON2WASM_UNSUPPORTED_BROWSER;const e={env:{emscripten_notify_memory_growth(){}}},R=A&&await async function(_="."){const O=await fetch(`${_}/simd-test.wasm`),A=await O.arrayBuffer();return WebAssembly.validate(A)}(_)?"argon2-simd.wasm":"argon2.wasm";let N;if("function"==typeof WebAssembly.instantiateStreaming)N=await WebAssembly.instantiateStreaming(fetch(`${_}/${R}`),e);else{const O=await fetch(`${_}/${R}`),A=await O.arrayBuffer();N=await WebAssembly.instantiate(A,e)}return N.instance.exports}onmessage=async function(_){(Array.isArray(_.data)||"object"!=typeof _.data)&&R({code:O.ErrorCodes.ARGON2WASM_BAD_REQUEST});const t=_.data;switch(t.method){case O.Methods.LoadArgon2:try{const _=t.params;A=await r(_.wasmRoot,_.simd)}catch(_){return void function(_){_ in O.ErrorCodes?R({code:_}):R({code:O.ErrorCodes.ARGON2WASM_UNKNOWN,message:e(_)})}(_)}R({code:O.ErrorCodes.ARGON2_OK});break;case O.Methods.Hash2i:const _=function(_){const O=_.salt.byteLength,e=A.malloc(O);let R=new Uint8Array(A.memory.buffer,e,O);for(let A=0;A<O;A++)R[A]=_.salt[A];const r=(new TextEncoder).encode(_.password.normalize("NFKC")),t=r.byteLength,T=A.malloc(t);let o=new Uint8Array(A.memory.buffer,T,t);for(let _=0;_<t;_++)o[_]=r[_];N(r);const s=_.hashLen,a=A.malloc(s),G=A.argon2i_hash_raw(_.timeCost,_.memoryCost,1,T,t,e,O,a,s);o=new Uint8Array(A.memory.buffer,T,t),N(o),A.free(T),R=new Uint8Array(A.memory.buffer,e,O),N(R),A.free(e),N(_.salt);const n=new Uint8Array(s),E=new Uint8Array(A.memory.buffer,a,s);for(let _=0;_<s;_++)n[_]=E[_];return N(E),A.free(a),{code:G,body:n}}(t.params);R({code:_.code,body:_.body},[_.body.buffer]);break;default:R({code:O.ErrorCodes.ARGON2WASM_BAD_REQUEST})}};
