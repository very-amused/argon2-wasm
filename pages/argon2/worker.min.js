/**
 * @license
 * @very-amused/argon2-wasm v0.3.4
 * MIT License
 * Copyright (c) 2023 Keith Scroggs
 */
class _{constructor(_){this.worker=_,this.worker.addEventListener("message",(_=>{this.onMessage(_)}),!0)}onMessage(_){this.resolve&&this.resolve(_.data)}postMessage(_,O=[]){const e=new Promise((_=>{this.resolve=_}));return this.worker.postMessage(_,O),e}terminate(){this.worker.removeEventListener("message",(_=>{this.onMessage(_)}),!0),this.worker.terminate()}}var O;let e;function A(_){return _ instanceof Error?_.message:"string"==typeof _?_:"An unknown error has occured, and a message was unable to be parsed from this error"}!function(O){var e,A;O.WorkerConnection=_,(e=O.Methods||(O.Methods={}))[e.LoadArgon2=0]="LoadArgon2",e[e.Hash2i=1]="Hash2i",e[e.UnloadArgon2=2]="UnloadArgon2",(A=O.ErrorCodes||(O.ErrorCodes={}))[A.ARGON2_OK=0]="ARGON2_OK",A[A.ARGON2_OUTPUT_PTR_NULL=-1]="ARGON2_OUTPUT_PTR_NULL",A[A.ARGON2_OUTPUT_TOO_SHORT=-2]="ARGON2_OUTPUT_TOO_SHORT",A[A.ARGON2_OUTPUT_TOO_LONG=-3]="ARGON2_OUTPUT_TOO_LONG",A[A.ARGON2_PWD_TOO_SHORT=-4]="ARGON2_PWD_TOO_SHORT",A[A.ARGON2_PWD_TOO_LONG=-5]="ARGON2_PWD_TOO_LONG",A[A.ARGON2_SALT_TOO_SHORT=-6]="ARGON2_SALT_TOO_SHORT",A[A.ARGON2_SALT_TOO_LONG=-7]="ARGON2_SALT_TOO_LONG",A[A.ARGON2_AD_TOO_SHORT=-8]="ARGON2_AD_TOO_SHORT",A[A.ARGON2_AD_TOO_LONG=-9]="ARGON2_AD_TOO_LONG",A[A.ARGON2_SECRET_TOO_SHORT=-10]="ARGON2_SECRET_TOO_SHORT",A[A.ARGON2_SECRET_TOO_LONG=-11]="ARGON2_SECRET_TOO_LONG",A[A.ARGON2_TIME_TOO_SMALL=-12]="ARGON2_TIME_TOO_SMALL",A[A.ARGON2_TIME_TOO_LARGE=-13]="ARGON2_TIME_TOO_LARGE",A[A.ARGON2_MEMORY_TOO_LITTLE=-14]="ARGON2_MEMORY_TOO_LITTLE",A[A.ARGON2_MEMORY_TOO_MUCH=-15]="ARGON2_MEMORY_TOO_MUCH",A[A.ARGON2_LANES_TOO_FEW=-16]="ARGON2_LANES_TOO_FEW",A[A.ARGON2_LANES_TOO_MANY=-17]="ARGON2_LANES_TOO_MANY",A[A.ARGON2_PWD_PTR_MISMATCH=-18]="ARGON2_PWD_PTR_MISMATCH",A[A.ARGON2_SALT_PTR_MISMATCH=-19]="ARGON2_SALT_PTR_MISMATCH",A[A.ARGON2_SECRET_PTR_MISMATCH=-20]="ARGON2_SECRET_PTR_MISMATCH",A[A.ARGON2_AD_PTR_MISMATCH=-21]="ARGON2_AD_PTR_MISMATCH",A[A.ARGON2_MEMORY_ALLOCATION_ERROR=-22]="ARGON2_MEMORY_ALLOCATION_ERROR",A[A.ARGON2_FREE_MEMORY_CBK_NULL=-23]="ARGON2_FREE_MEMORY_CBK_NULL",A[A.ARGON2_ALLOCATE_MEMORY_CBK_NULL=-24]="ARGON2_ALLOCATE_MEMORY_CBK_NULL",A[A.ARGON2_INCORRECT_PARAMETER=-25]="ARGON2_INCORRECT_PARAMETER",A[A.ARGON2_INCORRECT_TYPE=-26]="ARGON2_INCORRECT_TYPE",A[A.ARGON2_OUT_PTR_MISMATCH=-27]="ARGON2_OUT_PTR_MISMATCH",A[A.ARGON2_THREADS_TOO_FEW=-28]="ARGON2_THREADS_TOO_FEW",A[A.ARGON2_THREADS_TOO_MANY=-29]="ARGON2_THREADS_TOO_MANY",A[A.ARGON2_MISSING_ARGS=-30]="ARGON2_MISSING_ARGS",A[A.ARGON2_ENCODING_FAIL=-31]="ARGON2_ENCODING_FAIL",A[A.ARGON2_DECODING_FAIL=-32]="ARGON2_DECODING_FAIL",A[A.ARGON2_THREAD_FAIL=-33]="ARGON2_THREAD_FAIL",A[A.ARGON2_DECODING_LENGTH_FAIL=-34]="ARGON2_DECODING_LENGTH_FAIL",A[A.ARGON2_VERIFY_MISMATCH=-35]="ARGON2_VERIFY_MISMATCH",A[A.ARGON2WASM_UNKNOWN=1]="ARGON2WASM_UNKNOWN",A[A.ARGON2WASM_BAD_REQUEST=2]="ARGON2WASM_BAD_REQUEST",A[A.ARGON2WASM_UNSUPPORTED_BROWSER=3]="ARGON2WASM_UNSUPPORTED_BROWSER"}(O||(O={}));const R=(_,O=[])=>{self.postMessage(_,O)};function r(_,O){for(let e=0;e<O.length;e++)_[e]=O[e]}function o(_,O=3){for(let e=0;e<O;e++)for(let O=0;O<_.length;O++)_[O]=0}async function N(_=".",e=!1,A=!1){if("object"!=typeof WebAssembly)throw O.ErrorCodes.ARGON2WASM_UNSUPPORTED_BROWSER;if(e&&(e=await async function(_="."){const O=await fetch(`${_}/simd-test.wasm`),e=await O.arrayBuffer();return WebAssembly.validate(e)}(_)),A&&(A="undefined"!=typeof SharedArrayBuffer),A){const O=`${_}/${`argon2${e?"-simd":""}-pthread.js`}`;importScripts(O);const R=new WebAssembly.Memory({initial:1024,maximum:65536,shared:!0}),r=await LoadArgon2Wasm({mainScriptUrlOrBlob:O,wasmMemory:R});return{malloc:r._malloc,free:r._free,argon2i_hash_raw:r._argon2i_hash_raw,memory:R,pthread:A}}{const O=`argon2${e?"-simd":""}.wasm`,R={env:{emscripten_notify_memory_growth(){}}};return{...(await WebAssembly.instantiateStreaming(fetch(`${_}/${O}`),R)).instance.exports,pthread:A}}}onmessage=async function(_){(Array.isArray(_.data)||"object"!=typeof _.data)&&R({code:O.ErrorCodes.ARGON2WASM_BAD_REQUEST});const t=_.data;switch(t.method){case O.Methods.LoadArgon2:try{const _=t.params;e=await N(_.wasmRoot,_.simd,_.pthread)}catch(_){return void function(_){"number"==typeof _&&_ in O.ErrorCodes?R({code:_}):R({code:O.ErrorCodes.ARGON2WASM_UNKNOWN,message:A(_)})}(_)}R({code:O.ErrorCodes.ARGON2_OK});break;case O.Methods.Hash2i:const _=function(_){const O=_.salt.byteLength,A=e.malloc(O);let R=new Uint8Array(e.memory.buffer,A,O);r(R,_.salt);const N=(new TextEncoder).encode(_.password),t=N.byteLength,T=e.malloc(t);let s=new Uint8Array(e.memory.buffer,T,t);r(s,N),o(N);const a=_.hashLen,n=e.malloc(a),G=e.argon2i_hash_raw(_.timeCost,_.memoryCost,e.pthread?_.threads:1,T,t,A,O,n,a);s=new Uint8Array(e.memory.buffer,T,t),o(s),e.free(T),R=new Uint8Array(e.memory.buffer,A,O),o(R),e.free(A),o(_.salt);const E=new Uint8Array(a),M=new Uint8Array(e.memory.buffer,n,a);return r(E,M),o(M),e.free(n),{code:G,body:E}}(t.params);R({code:_.code,body:_.body},[_.body.buffer]);break;default:R({code:O.ErrorCodes.ARGON2WASM_BAD_REQUEST})}};
