/**
 * @license
 * @very-amused/argon2-wasm v0.4.0
 * MIT License
 * Copyright (c) 2023 Keith Scroggs
 */
class _{constructor(_){this.worker=_,this.worker.addEventListener("message",(_=>{this.onMessage(_)}),!0)}onMessage(_){this.resolve&&this.resolve(_.data)}postMessage(_,O=[]){const e=new Promise((_=>{this.resolve=_}));return this.worker.postMessage(_,O),e}terminate(){this.worker.removeEventListener("message",(_=>{this.onMessage(_)}),!0),this.worker.terminate()}}var O;let e;function r(_){return _ instanceof Error?_.message:"string"==typeof _?_:"An unknown error has occured, and a message was unable to be parsed from this error"}!function(O){var e,r;O.WorkerConnection=_,(e=O.Methods||(O.Methods={}))[e.LoadArgon2=0]="LoadArgon2",e[e.Hash2i=1]="Hash2i",e[e.Hash2d=2]="Hash2d",e[e.Hash2id=3]="Hash2id",e[e.UnloadArgon2=4]="UnloadArgon2",(r=O.ErrorCodes||(O.ErrorCodes={}))[r.ARGON2_OK=0]="ARGON2_OK",r[r.ARGON2_OUTPUT_PTR_NULL=-1]="ARGON2_OUTPUT_PTR_NULL",r[r.ARGON2_OUTPUT_TOO_SHORT=-2]="ARGON2_OUTPUT_TOO_SHORT",r[r.ARGON2_OUTPUT_TOO_LONG=-3]="ARGON2_OUTPUT_TOO_LONG",r[r.ARGON2_PWD_TOO_SHORT=-4]="ARGON2_PWD_TOO_SHORT",r[r.ARGON2_PWD_TOO_LONG=-5]="ARGON2_PWD_TOO_LONG",r[r.ARGON2_SALT_TOO_SHORT=-6]="ARGON2_SALT_TOO_SHORT",r[r.ARGON2_SALT_TOO_LONG=-7]="ARGON2_SALT_TOO_LONG",r[r.ARGON2_AD_TOO_SHORT=-8]="ARGON2_AD_TOO_SHORT",r[r.ARGON2_AD_TOO_LONG=-9]="ARGON2_AD_TOO_LONG",r[r.ARGON2_SECRET_TOO_SHORT=-10]="ARGON2_SECRET_TOO_SHORT",r[r.ARGON2_SECRET_TOO_LONG=-11]="ARGON2_SECRET_TOO_LONG",r[r.ARGON2_TIME_TOO_SMALL=-12]="ARGON2_TIME_TOO_SMALL",r[r.ARGON2_TIME_TOO_LARGE=-13]="ARGON2_TIME_TOO_LARGE",r[r.ARGON2_MEMORY_TOO_LITTLE=-14]="ARGON2_MEMORY_TOO_LITTLE",r[r.ARGON2_MEMORY_TOO_MUCH=-15]="ARGON2_MEMORY_TOO_MUCH",r[r.ARGON2_LANES_TOO_FEW=-16]="ARGON2_LANES_TOO_FEW",r[r.ARGON2_LANES_TOO_MANY=-17]="ARGON2_LANES_TOO_MANY",r[r.ARGON2_PWD_PTR_MISMATCH=-18]="ARGON2_PWD_PTR_MISMATCH",r[r.ARGON2_SALT_PTR_MISMATCH=-19]="ARGON2_SALT_PTR_MISMATCH",r[r.ARGON2_SECRET_PTR_MISMATCH=-20]="ARGON2_SECRET_PTR_MISMATCH",r[r.ARGON2_AD_PTR_MISMATCH=-21]="ARGON2_AD_PTR_MISMATCH",r[r.ARGON2_MEMORY_ALLOCATION_ERROR=-22]="ARGON2_MEMORY_ALLOCATION_ERROR",r[r.ARGON2_FREE_MEMORY_CBK_NULL=-23]="ARGON2_FREE_MEMORY_CBK_NULL",r[r.ARGON2_ALLOCATE_MEMORY_CBK_NULL=-24]="ARGON2_ALLOCATE_MEMORY_CBK_NULL",r[r.ARGON2_INCORRECT_PARAMETER=-25]="ARGON2_INCORRECT_PARAMETER",r[r.ARGON2_INCORRECT_TYPE=-26]="ARGON2_INCORRECT_TYPE",r[r.ARGON2_OUT_PTR_MISMATCH=-27]="ARGON2_OUT_PTR_MISMATCH",r[r.ARGON2_THREADS_TOO_FEW=-28]="ARGON2_THREADS_TOO_FEW",r[r.ARGON2_THREADS_TOO_MANY=-29]="ARGON2_THREADS_TOO_MANY",r[r.ARGON2_MISSING_ARGS=-30]="ARGON2_MISSING_ARGS",r[r.ARGON2_ENCODING_FAIL=-31]="ARGON2_ENCODING_FAIL",r[r.ARGON2_DECODING_FAIL=-32]="ARGON2_DECODING_FAIL",r[r.ARGON2_THREAD_FAIL=-33]="ARGON2_THREAD_FAIL",r[r.ARGON2_DECODING_LENGTH_FAIL=-34]="ARGON2_DECODING_LENGTH_FAIL",r[r.ARGON2_VERIFY_MISMATCH=-35]="ARGON2_VERIFY_MISMATCH",r[r.ARGON2WASM_UNKNOWN=1]="ARGON2WASM_UNKNOWN",r[r.ARGON2WASM_BAD_REQUEST=2]="ARGON2WASM_BAD_REQUEST",r[r.ARGON2WASM_UNSUPPORTED_BROWSER=3]="ARGON2WASM_UNSUPPORTED_BROWSER"}(O||(O={}));const A=(_,O=[])=>{self.postMessage(_,O)};function R(_,O){for(let e=0;e<O.length;e++)_[e]=O[e]}function o(_,O=3){for(let e=0;e<O;e++)for(let O=0;O<_.length;O++)_[O]=0}async function a(_=".",e=!1,r=!1){if("object"!=typeof WebAssembly)throw O.ErrorCodes.ARGON2WASM_UNSUPPORTED_BROWSER;if(e&&(e=await async function(_="."){const O=await fetch(`${_}/simd-test.wasm`),e=await O.arrayBuffer();return WebAssembly.validate(e)}(_)),r&&(r="undefined"!=typeof SharedArrayBuffer),r){const O=`${_}/${`argon2${e?"-simd":""}-pthread.js`}`;importScripts(O);const A=new WebAssembly.Memory({initial:1024,maximum:65536,shared:!0}),R=await LoadArgon2Wasm({mainScriptUrlOrBlob:O,wasmMemory:A});return{malloc:R._malloc,free:R._free,argon2i_hash_raw:R._argon2i_hash_raw,argon2d_hash_raw:R._argon2d_hash_raw,argon2id_hash_raw:R._argon2id_hash_raw,memory:A,pthread:r}}{const O=`argon2${e?"-simd":""}.wasm`,A={env:{emscripten_notify_memory_growth(){}}};return{...(await WebAssembly.instantiateStreaming(fetch(`${_}/${O}`),A)).instance.exports,pthread:r}}}function s(_,O){const r=_.salt.byteLength,A=e.malloc(r);let a=new Uint8Array(e.memory.buffer,A,r);R(a,_.salt);const s=(new TextEncoder).encode(_.password),t=s.byteLength,N=e.malloc(t);let T=new Uint8Array(e.memory.buffer,N,t);R(T,s),o(s);const n=_.hashLen,G=e.malloc(n);let E;switch(O){case"2i":E=e.argon2i_hash_raw;break;case"2d":E=e.argon2d_hash_raw;break;case"2id":E=e.argon2id_hash_raw}const d=E(_.timeCost,_.memoryCost,e.pthread?_.threads:1,N,t,A,r,G,n);T=new Uint8Array(e.memory.buffer,N,t),o(T),e.free(N),a=new Uint8Array(e.memory.buffer,A,r),o(a),e.free(A),o(_.salt);const i=new Uint8Array(n),M=new Uint8Array(e.memory.buffer,G,n);return R(i,M),o(M),e.free(G),{code:d,body:i}}onmessage=async function(_){(Array.isArray(_.data)||"object"!=typeof _.data)&&A({code:O.ErrorCodes.ARGON2WASM_BAD_REQUEST});const R=_.data;switch(R.method){case O.Methods.LoadArgon2:try{const _=R.params;e=await a(_.wasmRoot,_.simd,_.pthread)}catch(_){return void function(_){"number"==typeof _&&_ in O.ErrorCodes?A({code:_}):A({code:O.ErrorCodes.ARGON2WASM_UNKNOWN,message:r(_)})}(_)}A({code:O.ErrorCodes.ARGON2_OK});break;case O.Methods.Hash2i:{const _=s(R.params,"2i");A({code:_.code,body:_.body},[_.body.buffer])}break;case O.Methods.Hash2d:{const _=s(R.params,"2d");A({code:_.code,body:_.body},[_.body.buffer])}break;case O.Methods.Hash2id:{const _=s(R.params,"2id");A({code:_.code,body:_.body},[_.body.buffer])}break;default:A({code:O.ErrorCodes.ARGON2WASM_BAD_REQUEST})}};
